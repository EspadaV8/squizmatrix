<queries id="core">


	<!-- //        PACKAGES        // -->


	<query id="installPackage">
	<!-- Registers a package's presence inside the MySource Matrix system. -->
		<primary>
			<insert>
				<fields table="sq_pkg">
					<field>code_name</field>
					<field>version</field>
					<field>name</field>
					<field>description</field>
				</fields>
				<values>
					<value column="code_name">:package_name</value>
					<value column="version">:version</value>
					<value column="name">:name</value>
					<value column="description">:description</value>
				</values>
			</insert>
		</primary>
	</query>
	<query id="updatePackage">
	<!-- Update the information about an installed package. -->
		<primary>
			<update>
				<fields table="sq_pkg">
					<field>version</field>
					<field>name</field>
					<field>description</field>
				</fields>
				<values>
					<value column="version">:version</value>
					<value column="name">:name</value>
					<value column="description">:description</value>
				</values>
				<where>
					<equal table="sq_pkg" column="code_name">:package_name</equal>
				</where>
			</update>
		</primary>
	</query>
	<query id="getInstalledPackages">
		<!-- Returns a list of all installed packages. -->
		<primary>
			<select>
				<fields>
					<field table="sq_pkg" column="code_name" />
					<field table="sq_pkg" column="version" />
					<field table="sq_pkg" column="name" />
					<field table="sq_pkg" column="description" />
				</fields>
				<from>
					<table>sq_pkg</table>
				</from>
			</select>
		</primary>
	</query>


	<!-- //        URL SYSTEM        // -->


	<query id="getAuthRedirect">
		<!-- Returns the URL entry marked as the authentication redirect for a certain root URL. -->
		<primary>
			<select>
				<fields>
					<field table="sq_ast_url" column="url" />
					<field table="sq_ast_url" column="http" />
					<field table="sq_ast_url" column="https" />
				</fields>
				<from>
					<table>sq_ast_url</table>
				</from>
				<where>
					<in table="sq_ast_url" column="urlid">
						<select>
							<fields>
								<field table="sq_ast_url" column="auth_urlid" />
							</fields>
							<where>
								<equal table="sq_ast_url" column="urlid">:urlid</equal>
							</where>
						</select>
					</in>
				</where>
			</select>
		</primary>
	</query>


	<!-- //        LINKING SYSTEM        // -->

	<query id="isAssetDependentlyLinked">
		<!-- Returns link IDs where the a specified asset is dependently linked. -->
		<primary>
			<select>
				<fields>
					<field table="sq_ast_lnk" column="linkid" />
				</fields>
				<from>
					<table>sq_ast_lnk</table>
				</from>
				<where>
					<equal table="sq_ast_lnk" column="minorid">:assetid</equal>
					<equal table="sq_ast_lnk" column="is_dependant">1</equal>
				</where>
			</select>
		</primary>
	</query>
</queries>
